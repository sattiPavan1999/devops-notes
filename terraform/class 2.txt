    1  sudo yum install -y yum-utils shadow-utils
    2  sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo
    3  sudo yum install terraform
(Install terraform)


USER permission

    4  mkdir myfiles
    5  cd myfiles/
    6  aws configure
(here give AWS Access Key ID, and passkey which we got from iam user setup from aws)
(so that we can create instances)

    4  vim provider.tf
(
provider "aws" {
region = "ap-south-1"
}
)
(We are specifying the cloud provider with its region)

    5  vim resource.tf
(
resource "aws_instance" "myserver" {

tags = {
Name = "flm-terraform-server"
Environment = "Dev"
Client = "AT&T"
}

ami = "ami-00ca570c1b6d79f36"

instance_type = "t2.micro"

key_name = "new-mac-key"

availability_zone = "ap-south-1b"

root_block_device {
volume_size = 20
}

}
)

(We have to specify the resources of an instance to launch)
(Ami ID should be same as the cloud provider region which we specified in the provider.tf file)
("myserver" is the label here)
(Environment and Client are the optional fields)
(If we did not specify availability_zone then it will take any availability_zone from the region)

    7  terraform init
(To initialize the terraform)

    8  terraform fmt
(It will apply the indentation to all the tf files)

   10  terraform plan
(If there are any error, then it will tell)
(Here we may get Error: No valid credential sources found)
(We get this because we don’t have permission to create an instance so we have to assign an IAM role permission to our ec2 server with fullec2permission then we can perform this command again then we don’t get error)

   13  terraform apply --auto-approve
(To create the instance or to apply the terraform file to create the instance)

   12  vim resource.tf
(
resource "aws_instance" "myserver" {

tags = {
Name = "dev-server"
Environment = "Dev"
Client = "AT&T"
}

ami = "ami-00ca570c1b6d79f36"

instance_type = "t2.micro"

key_name = "new-mac-key"

availability_zone = "ap-south-1b"

root_block_device {
volume_size = 20
}

}
)
(here change the Name to Name = "dev-server")

   13  terraform plan
(run this so that it will give what are the changes)

   14  terraform apply --auto-approve
(apply the changes so that we can see the server name in ec2)

   16  cat terraform.tfstate
(we can see all the present values in this file)

   17  ll
(Now we can see terraform.tfstate.backup  is created)

   18  cat terraform.tfstate.backup 
(we can see the previous terraform.tfstate file values like Name = "flm-terraform-server" )
(It is a backup file)

   19  terraform destroy --auto-approve



variables 



   21  vim provider.tf
(
provider "aws" {
  region = "ap-south-1"
}
)

   22  vim resource.tf 
(
resource "aws_instance" "myserver" {

  tags = {
    Name = var.iname
  }

  ami = var.ami_id

  instance_type = var.itype

  count = var.icount

  key_name = "new-mac-key"

  root_block_device {
    volume_size = var.ivolume
  }

}
)

   23  vim variable.tf
(
variable "iname" {
  description = "this is instance name"
  type        = string
  default     = "swiggy-instance"
}

variable "ami_id" {
  description = "this is ami Id"
  type        = string
  default     = "ami-00ca570c1b6d79f36"
}

variable "itype" {
  description = "this is instance type"
  type        = string
  default     = "t2.micro"
}

variable "icount" {
  description = "this is instance count"
  type        = number
  default     = 3
}

variable "ivolume" {
  description = "this is volume"
  type        = number
  default     = 10
}

)

   26  terraform fmt

   29  terraform plan

   30  terraform apply --auto-approve



output


   38  vim out.tf
(
output "myoutput" {
value = [aws_instance.myserver[0].id, aws_instance.myserver[1].id,  aws_instance.myserver[2].id]
}
)
   39  terraform apply --auto-approve
(we will get the IDs of the instances)

   42  terraform destroy --target=aws_instance.myserver[1] --auto-approve
(To terminate the instance 1 out of 3 instances)

  43  terraform destroy  --auto-approve
(To terminate all the instances)
